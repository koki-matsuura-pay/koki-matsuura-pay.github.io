<html>
<head></head>
<body>
<script>
var createAPITunnel = function(m, n, o) {
  var url = decodeURIComponent(window.location.hash.replace(/^#/, "")),
      domain = url.replace(/#.*$/, "").replace(/([^:]+:\/\/[^\/]+).*/, "$1");
    if (typeof m === "undefined") {
      var m = {},
          l = function(g) {
            if (typeof g === "undefined") {
              var g = {},
                  k = function() {
                    var a = {};
                    a.serialize = function(h, b) {
                      var d = [],
                          f;
                        for (f in h)
                            if (h.hasOwnProperty(f)) {
                                var e = b ? b + "[" + f + "]" : f, c = h[f];
                                d.push(typeof c == "object" ? a.serialize(c, e) : encodeURIComponent(e) + "=" + encodeURIComponent(c))
                            }
                        return d.join("&")
                    };
                    a.deserialize = function(h) {
                        for (var b = {}, h = h.split("&"), d = h.length, f = null, e = null, c = 0; c < d; ++c) {
                            e = h[c].split("=");
                            e[0] = decodeURIComponent(e[0]);
                            e[1] =
                            decodeURIComponent(e[1]);
                            for (var a = e[0], f = [], j = -1; (j = a.indexOf("[")) !== -1; )
                                f.push(a.substr(j, a.indexOf("]") - j + 1)), a = a.substr(a.indexOf("]") + 1);
                            if (f.length === 0)
                                b[e[0]] = e[1];
                            else {
                                j = e[0].substr(0, e[0].indexOf("["));
                                typeof b[j] === "undefined" && (b[j] = {});
                                for (var a = b[j], g = f.length, k = 0; k < g - 1; ++k)
                                    j = f[k].substr(1, f[k].length - 2), typeof a[j] === "undefined" && (a[j] = {}), a = a[j];
                                f = f[g - 1];
                                j = f.substr(1, f.length - 2);
                                a[j] = e[1]
                            }
                        }
                        return b
                    };
                    return a
                };
                typeof g !== "undefined" ? g = k() : exports.createSerializer = k
            }
            return {postMessage: function(a,
                h, b, d) {
                    if (typeof window !== "undefined")
                        a = g.serialize(a), typeof window.postMessage === "undefined" ? d.location.href = b + "#" + +new Date + Math.floor(Math.random() * 1E3) + "&" + a : d.postMessage(a, h)
                },receiveMessage: function(a, h) {
                    if (typeof window !== "undefined")
                        if (window.postMessage)
                            attachedCallback = function(b) {
                                if (b.origin.toLowerCase() !== h.toLowerCase())
                                    return !1;
                                a(g.deserialize(b.data))
                            }, window.addEventListener ? window.addEventListener("message", attachedCallback, !1) : window.attachEvent("onmessage", attachedCallback);
                        else {
                            var b = window.location.hash;
                            setInterval(function() {
                                var d = window.location.hash, h = /^#?\d+&/;
                                if (d !== b && h.test(d))
                                    b = d, window.location.hash = "", a(g.deserialize(d.replace(h, "")))
                            }, 100)
                        }
                }}
        };
        typeof m !== "undefined" ? m = l() : exports.createXD = l
    }
    if (typeof n === "undefined")
        n = {}, l = function() {
            function g(a) {
                if (/([^\u0000-\u00ff])/.test(a))
                    throw Error("Can't base64 encode non-ASCII characters.");
                for (var b = 0, d, f, e, c = []; b < a.length; ) {
                    d = a.charCodeAt(b);
                    e = b % 3;
                    switch (e) {
                        case 0:
                            c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d >>
                            2));
                            break;
                        case 1:
                            c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((f & 3) << 4 | d >> 4));
                            break;
                        case 2:
                            c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((f & 15) << 2 | d >> 6)), c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d & 63))
                    }
                    f = d;
                    b++
                }
                e == 0 ? (c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((f & 3) << 4)), c.push("==")) : e == 1 && (c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((f &
                15) << 2)), c.push("="));
                return c.join("")
            }
            var k = '{"bindings_version":"2.0.0", "lang":"javascript", "publisher":"payjp", "url": "' + url + '", "domain": "' + domain + '", "platform":"undefined"}',
                a = {
                  getHTTPObject: function() {
                    var a = !1;
                    if (typeof ActiveXObject != "undefined")
                        try {
                            a = new ActiveXObject("Msxml2.XMLHTTP")
                        } catch (b) {
                            try {
                                a = new ActiveXObject("Microsoft.XMLHTTP")
                            } catch (d) {
                                a =
                                !1
                            }
                        }
                    else if (window.XMLHttpRequest)
                        try {
                            a = new XMLHttpRequest
                        } catch (f) {
                            a = !1
                        }
                    return a
                    },
                    load: function(h, b, d, f, keyType, locale, e) {
                    var c = a.init();
                    if (c && b) {
                        var h = (h || "GET").toUpperCase(), i;
                        b += b.indexOf("?") + 1 ? "&" : "?";
                        i = null;
                        h == "POST" && (i = b.split("?"), b = i[0], i = i[1]);
                        c.open(h, b, !0);
                        c.setRequestHeader("X-Requested-With", "XMLHttpRequest");
                        c.setRequestHeader("X-Payjp-Client-User-Agent", k);
                        if(!keyType){
                          c.setRequestHeader("Authorization", "Basic " + g(d + ":" + f));
                        } else {
                          c.setRequestHeader("Authorization", keyType + " " + d);
                        }
                        if(locale){
                          c.setRequestHeader("Locale", locale);
                        }
                        h == "POST" && c.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                        c.onreadystatechange = function() {
                            if (c.readyState == 4) {
                                var a = "";
                                c.responseText && (a = c.responseText);
                                e && e(c.status, a)
                            }
                        };
                        c.send(i)
                    }
                }};
            a.init = function() {
                return a.getHTTPObject()
            };
            return a
        }, typeof n !== "undefined" ? n = l() : exports.createJX = l;
    if (typeof o === "undefined")
        o = {}, l = function() {
            var g = {};
            g.serialize = function(k, a) {
                var h = [], b;
                for (b in k)
                    if (k.hasOwnProperty(b)) {
                        var d = a ? a + "[" + b + "]" : b, f = k[b];
                        h.push(typeof f == "object" ? g.serialize(f, d) : encodeURIComponent(d) + "=" + encodeURIComponent(f))
                    }
                return h.join("&")
            };
            g.deserialize =
            function(g) {
                for (var a = {}, g = g.split("&"), h = g.length, b = null, d = null, f = 0; f < h; ++f) {
                    d = g[f].split("=");
                    d[0] = decodeURIComponent(d[0]);
                    d[1] = decodeURIComponent(d[1]);
                    for (var e = d[0], b = [], c = -1; (c = e.indexOf("[")) !== -1; )
                        b.push(e.substr(c, e.indexOf("]") - c + 1)), e = e.substr(e.indexOf("]") + 1);
                    if (b.length === 0)
                        a[d[0]] = d[1];
                    else {
                        c = d[0].substr(0, d[0].indexOf("["));
                        typeof a[c] === "undefined" && (a[c] = {});
                        for (var e = a[c], i = b.length, j = 0; j < i - 1; ++j)
                            c = b[j].substr(1, b[j].length - 2), typeof e[c] === "undefined" && (e[c] = {}), e = e[c];
                        b = b[i -
                        1];
                        c = b.substr(1, b.length - 2);
                        e[c] = d[1]
                    }
                }
                return a
            };
            return g
        }, typeof o !== "undefined" ? o = l() : exports.createSerializer = l;
        var i = {
            parentURL: null,
            parentDomain: null
        };
    i.handleMessage = function(g) {
        // g にメッセージオブジェクトが渡ってくる
        var k = g.id;
        n.load(g.method, g.url + "?" + o.serialize(g.params), g.key, "", g.keyType, g.locale, function(a, g) {
            m.postMessage({
                id: k,
                status: a,
                response: g
            },
            i.parentDomain,
            i.parentURL,
            parent)
        })
    };
    i.init = function() {
        i.parentURL = decodeURIComponent(window.location.hash.replace(/^#/, "")).replace(/#.*$/, "");
        i.parentDomain = i.parentURL.replace(/([^:]+:\/\/[^\/]+).*/,
        "$1");
        m.receiveMessage(i.handleMessage,
                         i.parentDomain)
    };
    return i
};

// End of createAPITunnel

if (typeof exports !== "undefined" && exports !== null)
    exports.createAPITunnel = createAPITunnel;
else {
    var apiTunnel = createAPITunnel();
    apiTunnel.init()
};
</script>

</body>
</html>
